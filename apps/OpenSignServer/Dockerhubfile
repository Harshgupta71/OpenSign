# Use an official Node runtime as the base image
FROM node:20

# Set environment variables
ENV DO_ACCESS_KEY_ID=
ENV PARSE_MOUNT=/app
ENV GENERATE_SOURCEMAP=false
ENV SMTP_USER_EMAIL=mailer@yourdomain.com
ENV MAILGUN_DOMAIN=mail.yourdomain.com
ENV SMTP_PASS=password
ENV PASS_PHRASE=opensign
ENV PUBLIC_URL=https://localhost:3001
ENV SMTP_HOST=smtp.yourhost.com
ENV APP_ID=opensign
ENV DO_ENDPOINT=ams3.digitaloceanspaces.com
ENV MAILGUN_API_KEY=
ENV SMTP_ENABLE=true
ENV PFX_BASE64=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\nAggA
ENV DO_REGION=us-west
ENV appName=open_sign_server
# ENV MONGODB_URI=mongodb://mongo-container:27017/OpenSignDB
ENV MONGODB_URI=mongodb://host.docker.internal:27017/OpenSignDB    
ENV MASTER_KEY=XnAadwKxxByMr
ENV NODE_ENV=production
ENV SERVER_URL=https://localhost:3001/app
ENV DO_SECRET_ACCESS_KEY=
ENV DO_SPACE=DOSPACENAME
ENV REACT_APP_APPID=opensign
ENV DO_BASEURL=https://DOSPACENAME.ams3.digitaloceanspaces.com
ENV USE_LOCAL=true
ENV MAILGUN_SENDER=postmaster@mail.yourdomain.com
ENV SMTP_PORT=443
ENV PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

# Set the working directory inside the container
WORKDIR /usr/src/app

# Copy package.json and package-lock.json first to leverage Docker cache
COPY apps/OpenSignServer/package*.json ./

# Install application dependencies
RUN npm install

# If you have native dependencies, you'll need extra tools. Uncomment the following line if needed.
# RUN apk add --no-cache make gcc g++ python3

# Copy the current directory contents into the container
COPY apps/OpenSignServer/ .

# Make port 8080 available to the world outside this container
EXPOSE 8080

# Define environment variables if needed
# ENV NODE_ENV production
# ENV DATABASE_URL mongodb://db:27017

# Run the application
CMD ["npm", "start"]
